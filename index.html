<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Energy Savings Calculator</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      display: flex;
      justify-content: center;
      padding: 30px;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 600px;
    }
    input, select, button {
      display: block;
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      font-size: 16px;
    }
    button {
      background: #ddd;
      border: none;
      cursor: pointer;
    }
    .inline-help { font-size: 12px; color: #666; margin-top: -6px; }
    ul { list-style: none; padding: 0; }
    li {
      background: #e0f2ff;
      padding: 12px;
      margin-top: 10px;
      border-radius: 5px;
    }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Energy Savings Calculator</h1>

    <form id="appliance-form">
      <input type="text" id="appliance-name" placeholder="Appliance Name (e.g., fridge)" required />
      <div class="row">
        <input type="number" id="wattage" step="any" placeholder="Wattage (optional)" />
        <input type="number" id="amps" step="any" placeholder="Amps (e.g., 3.3)" />
      </div>
      <div class="row">
        <input type="number" id="volts" step="any" placeholder="Volts (e.g., 120)" />
        <input type="number" id="hours-off" step="any" placeholder="Hours Off Per Day" required />
      </div>
      <input type="number" id="kwh-rate" step="any" placeholder="kWh Rate (¢)" required />

      <!-- New: Output mode -->
      <label for="output-mode"><strong>Output Mode</strong></label>
      <select id="output-mode">
        <option value="rates" selected>Rates (per day / month / year)</option>
        <option value="custom">Custom Period (total since start/end)</option>
      </select>

      <!-- New: Custom period inputs -->
      <div id="custom-period" class="hidden">
        <label for="start-dt">Start (required)</label>
        <input type="datetime-local" id="start-dt" />
        <label for="end-dt">End (optional, defaults to now)</label>
        <input type="datetime-local" id="end-dt" />
        <div class="inline-help">
          Uses your “Hours Off Per Day” as the daily schedule and scales by exact elapsed time.
        </div>
      </div>

      <button type="submit">Add Appliance</button>
    </form>

    <div id="savings-summary">
      <h2>Estimated Savings</h2>
      <ul id="appliance-list"></ul>
    </div>
  </div>

  <script>
    const CO2_LB_PER_KWH = 0.92; // pounds CO₂ per kWh
    const MS_PER_DAY = 24 * 60 * 60 * 1000;

    const modeEl = document.getElementById('output-mode');
    const customBox = document.getElementById('custom-period');
    modeEl.addEventListener('change', () => {
      customBox.classList.toggle('hidden', modeEl.value !== 'custom');
    });

    document.getElementById('appliance-form').addEventListener('submit', function (e) {
      e.preventDefault();

      const name = document.getElementById('appliance-name').value.trim();
      const wattageInput = parseFloat(document.getElementById('wattage').value);
      const amps = parseFloat(document.getElementById('amps').value);
      const volts = parseFloat(document.getElementById('volts').value);
      const hoursOff = parseFloat(document.getElementById('hours-off').value);
      const rateCents = parseFloat(document.getElementById('kwh-rate').value);
      const mode = document.getElementById('output-mode').value;

      if (!name || isNaN(hoursOff) || isNaN(rateCents)) {
        alert("Pleas
